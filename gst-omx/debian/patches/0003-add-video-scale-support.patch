Description: <short summary of the patch>
 TODO: Put a short summary on the line above and replace this paragraph
 with a longer explanation of this change. Complete the meta-information
 with other relevant fields (see below for details). To make it easier, the
 information below has been extracted from the changelog. Adjust it or drop
 it.
 .
 gst-omx (1.22.0-1) unstable; urgency=low
 .
   * New upstream release.
Author: Ying-Chun Liu (PaulLiu) <paulliu@debian.org>

---
The information above should follow the Patch Tagging Guidelines, please
checkout https://dep.debian.net/deps/dep3/ to learn about the format. Here
are templates for supplementary fields that you might want to add:

Origin: (upstream|backport|vendor|other), (<patch-url>|commit:<commit-id>)
Bug: <upstream-bugtracker-url>
Bug-Debian: https://bugs.debian.org/<bugnumber>
Bug-Ubuntu: https://launchpad.net/bugs/<bugnumber>
Forwarded: (no|not-needed|<patch-forwarded-url>)
Applied-Upstream: <version>, (<commit-url>|commit:<commid-id>)
Reviewed-By: <name and email of someone who approved/reviewed the patch>
Last-Update: 2023-03-01

--- gst-omx-1.22.0.orig/omx/gstomxvideodec.c
+++ gst-omx-1.22.0/omx/gstomxvideodec.c
@@ -2185,6 +2185,7 @@ static gboolean
 gst_omx_video_dec_negotiate (GstOMXVideoDec * self)
 {
   OMX_VIDEO_PARAM_PORTFORMATTYPE param;
+  OMX_PARAM_PORTDEFINITIONTYPE port_def;
   OMX_ERRORTYPE err;
   GstCaps *comp_supported_caps;
   GList *negotiation_map = NULL, *l;
@@ -2192,6 +2193,7 @@ gst_omx_video_dec_negotiate (GstOMXVideo
   GstVideoFormat format;
   GstStructure *s;
   const gchar *format_str;
+  gint width, height;
 
   GST_DEBUG_OBJECT (self, "Trying to negotiate a video format with downstream");
 
@@ -2281,6 +2283,31 @@ gst_omx_video_dec_negotiate (GstOMXVideo
         gst_omx_error_to_string (err), err);
   }
 
+  if (gst_structure_get_int(s, "width", &width) && gst_structure_get_int(s, "height", &height))
+  {
+    GST_OMX_INIT_STRUCT (&port_def);
+    port_def.nPortIndex = self->dec_out_port->index;
+    err = gst_omx_component_get_parameter (self->dec,
+        OMX_IndexParamPortDefinition, &port_def);
+    if (err != OMX_ErrorNone) {
+      GST_ERROR_OBJECT (self, "Failed to get video port definition: %s (0x%08x)",
+          gst_omx_error_to_string (err), err);
+      return FALSE;
+    }
+
+    port_def.format.video.nFrameHeight = height;
+    port_def.format.video.nFrameWidth = width;
+
+    err =
+      gst_omx_component_set_parameter (self->dec,
+      OMX_IndexParamPortDefinition, &port_def);
+    if (err != OMX_ErrorNone) {
+      GST_ERROR_OBJECT (self, "Failed to set video port definition: %s (0x%08x)",
+          gst_omx_error_to_string (err), err);
+      return FALSE;
+    }
+  }
+
   gst_caps_unref (intersection);
   return (err == OMX_ErrorNone);
 }
