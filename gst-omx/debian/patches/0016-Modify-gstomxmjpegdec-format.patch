Description: <short summary of the patch>
 TODO: Put a short summary on the line above and replace this paragraph
 with a longer explanation of this change. Complete the meta-information
 with other relevant fields (see below for details). To make it easier, the
 information below has been extracted from the changelog. Adjust it or drop
 it.
 .
 gst-omx (1.22.0-1) unstable; urgency=low
 .
   * New upstream release.
Author: Ying-Chun Liu (PaulLiu) <paulliu@debian.org>

---
The information above should follow the Patch Tagging Guidelines, please
checkout https://dep.debian.net/deps/dep3/ to learn about the format. Here
are templates for supplementary fields that you might want to add:

Origin: (upstream|backport|vendor|other), (<patch-url>|commit:<commit-id>)
Bug: <upstream-bugtracker-url>
Bug-Debian: https://bugs.debian.org/<bugnumber>
Bug-Ubuntu: https://launchpad.net/bugs/<bugnumber>
Forwarded: (no|not-needed|<patch-forwarded-url>)
Applied-Upstream: <version>, (<commit-url>|commit:<commid-id>)
Reviewed-By: <name and email of someone who approved/reviewed the patch>
Last-Update: 2023-03-01

--- gst-omx-1.22.0.orig/config/sf/gstomx.conf
+++ gst-omx-1.22.0/config/sf/gstomx.conf
@@ -42,4 +42,4 @@ in-port-index=0
 out-port-index=1
 rank=1
 hacks=pass-profile-to-decoder;pass-color-format-to-decoder;ensure-buffer-count-actual
-src-template-caps=video/x-raw, format = (string) { NV16_10LE32, NV12_10LE32, NV16, YUY2, YVYU, UYVY, NV12, NV21, I420, RGB16, BGR16, ABGR, ARGB, GRAY8, Y42B, Y444 }, width = (int) [ 1, max ], height = (int) [ 1, max ], framerate = (fraction) [ 0, max ]
+src-template-caps=video/x-raw, format = (string) { NV16_10LE32, NV12_10LE32, NV16, NV61, YUY2, YVYU, UYVY, NV12, NV21, I420, RGB16, BGR16, ABGR, ARGB, GRAY8, Y42B, Y444, VYUY, v308 }, width = (int) [ 1, max ], height = (int) [ 1, max ], framerate = (fraction) [ 0, max ]
--- gst-omx-1.22.0.orig/omx/gstomxbufferpool.c
+++ gst-omx-1.22.0/omx/gstomxbufferpool.c
@@ -355,10 +355,13 @@ gst_omx_buffer_pool_alloc_buffer (GstBuf
       case GST_VIDEO_FORMAT_ARGB:
       case GST_VIDEO_FORMAT_RGB16:
       case GST_VIDEO_FORMAT_BGR16:
+      case GST_VIDEO_FORMAT_GRAY8:
+        break;
       case GST_VIDEO_FORMAT_YUY2:
       case GST_VIDEO_FORMAT_UYVY:
       case GST_VIDEO_FORMAT_YVYU:
-      case GST_VIDEO_FORMAT_GRAY8:
+      case GST_VIDEO_FORMAT_VYUY:
+        stride[0] = GST_ROUND_UP_4(nstride * 2);
         break;
       case GST_VIDEO_FORMAT_I420:
         stride[1] = nstride / 2;
@@ -370,6 +373,7 @@ gst_omx_buffer_pool_alloc_buffer (GstBuf
       case GST_VIDEO_FORMAT_NV12_10LE32:
       case GST_VIDEO_FORMAT_NV16:
       case GST_VIDEO_FORMAT_NV16_10LE32:
+      case GST_VIDEO_FORMAT_NV61:
 #ifdef USE_OMX_TARGET_STARFIVE
       case GST_VIDEO_FORMAT_NV21:
 #endif
@@ -392,6 +396,9 @@ gst_omx_buffer_pool_alloc_buffer (GstBuf
         offset[1] = offset[0] + stride[0] * nslice;
         offset[2] = offset[1] + stride[1] * nslice;
         break;
+      case GST_VIDEO_FORMAT_v308:
+        stride[0] = GST_ROUND_UP_4(nstride * 3);
+        break;
 #endif
       default:
         g_assert_not_reached ();
--- gst-omx-1.22.0.orig/omx/gstomxvideo.c
+++ gst-omx-1.22.0/omx/gstomxvideo.c
@@ -99,11 +99,20 @@ gst_omx_video_get_format_from_omx (OMX_C
       format = GST_VIDEO_FORMAT_Y42B;
       break;
     case OMX_COLOR_FormatYUV444Interleaved:
-      format = GST_VIDEO_FORMAT_Y444;
+      format = GST_VIDEO_FORMAT_v308;
       break;
     case OMX_COLOR_FormatYVU420SemiPlanar:
       format = GST_VIDEO_FORMAT_NV21;
       break;
+    case OMX_COLOR_FormatCrYCbY:
+      format = GST_VIDEO_FORMAT_VYUY;
+      break;
+    case OMX_COLOR_FormatYUV444Planar:
+      format = GST_VIDEO_FORMAT_Y444;
+      break;
+    case OMX_COLOR_FormatYVU422SemiPlanar:
+      format = GST_VIDEO_FORMAT_NV61;
+      break;
 #endif
     default:
       format = GST_VIDEO_FORMAT_UNKNOWN;
--- gst-omx-1.22.0.orig/omx/gstomxvideodec.c
+++ gst-omx-1.22.0/omx/gstomxvideodec.c
@@ -646,6 +646,7 @@ gst_omx_video_dec_fill_buffer (GstOMXVid
         break;
 #ifdef USE_OMX_TARGET_STARFIVE
       case GST_VIDEO_FORMAT_Y444:
+      case GST_VIDEO_FORMAT_v308:
         dst_width[0] = GST_VIDEO_INFO_WIDTH (vinfo);
         dst_width[1] = GST_VIDEO_INFO_WIDTH (vinfo);
         dst_width[2] = GST_VIDEO_INFO_WIDTH (vinfo);
