Description: <short summary of the patch>
 TODO: Put a short summary on the line above and replace this paragraph
 with a longer explanation of this change. Complete the meta-information
 with other relevant fields (see below for details). To make it easier, the
 information below has been extracted from the changelog. Adjust it or drop
 it.
 .
 gst-omx (1.22.0-1) unstable; urgency=low
 .
   * New upstream release.
Author: Ying-Chun Liu (PaulLiu) <paulliu@debian.org>

---
The information above should follow the Patch Tagging Guidelines, please
checkout https://dep.debian.net/deps/dep3/ to learn about the format. Here
are templates for supplementary fields that you might want to add:

Origin: (upstream|backport|vendor|other), (<patch-url>|commit:<commit-id>)
Bug: <upstream-bugtracker-url>
Bug-Debian: https://bugs.debian.org/<bugnumber>
Bug-Ubuntu: https://launchpad.net/bugs/<bugnumber>
Forwarded: (no|not-needed|<patch-forwarded-url>)
Applied-Upstream: <version>, (<commit-url>|commit:<commid-id>)
Reviewed-By: <name and email of someone who approved/reviewed the patch>
Last-Update: 2023-03-01

--- gst-omx-1.22.0.orig/config/sf/gstomx.conf
+++ gst-omx-1.22.0/config/sf/gstomx.conf
@@ -42,3 +42,4 @@ in-port-index=0
 out-port-index=1
 rank=1
 hacks=pass-profile-to-decoder;pass-color-format-to-decoder;ensure-buffer-count-actual
+src-template-caps=video/x-raw, format = (string) { NV16_10LE32, NV12_10LE32, NV16, YUY2, YVYU, UYVY, NV12, NV21, I420, RGB16, BGR16, ABGR, ARGB, GRAY8, Y42B, Y444 }, width = (int) [ 1, max ], height = (int) [ 1, max ], framerate = (fraction) [ 0, max ]
--- gst-omx-1.22.0.orig/omx/gstomxbufferpool.c
+++ gst-omx-1.22.0/omx/gstomxbufferpool.c
@@ -370,9 +370,29 @@ gst_omx_buffer_pool_alloc_buffer (GstBuf
       case GST_VIDEO_FORMAT_NV12_10LE32:
       case GST_VIDEO_FORMAT_NV16:
       case GST_VIDEO_FORMAT_NV16_10LE32:
+#ifdef USE_OMX_TARGET_STARFIVE
+      case GST_VIDEO_FORMAT_NV21:
+#endif
         stride[1] = nstride;
         offset[1] = offset[0] + stride[0] * nslice;
         break;
+#ifdef USE_OMX_TARGET_STARFIVE
+      case GST_VIDEO_FORMAT_Y42B:
+        stride[0] = GST_ROUND_UP_4 (nstride);
+        stride[1] = GST_ROUND_UP_8 (nstride) / 2;
+        stride[2] = stride[1];
+
+        offset[1] = stride[0] * nslice;
+        offset[2] = offset[1] + stride[1] * nslice;
+        break;
+
+      case GST_VIDEO_FORMAT_Y444:
+        stride[1] = nstride;
+        stride[2] = nstride;
+        offset[1] = offset[0] + stride[0] * nslice;
+        offset[2] = offset[1] + stride[1] * nslice;
+        break;
+#endif
       default:
         g_assert_not_reached ();
         break;
--- gst-omx-1.22.0.orig/omx/gstomxvideo.c
+++ gst-omx-1.22.0/omx/gstomxvideo.c
@@ -94,6 +94,17 @@ gst_omx_video_get_format_from_omx (OMX_C
       break;
 #pragma GCC diagnostic pop
 #endif
+#ifdef USE_OMX_TARGET_STARFIVE
+    case OMX_COLOR_FormatYUV422Planar:
+      format = GST_VIDEO_FORMAT_Y42B;
+      break;
+    case OMX_COLOR_FormatYUV444Interleaved:
+      format = GST_VIDEO_FORMAT_Y444;
+      break;
+    case OMX_COLOR_FormatYVU420SemiPlanar:
+      format = GST_VIDEO_FORMAT_NV21;
+      break;
+#endif
     default:
       format = GST_VIDEO_FORMAT_UNKNOWN;
       break;
--- gst-omx-1.22.0.orig/omx/gstomxvideodec.c
+++ gst-omx-1.22.0/omx/gstomxvideodec.c
@@ -592,6 +592,9 @@ gst_omx_video_dec_fill_buffer (GstOMXVid
       case GST_VIDEO_FORMAT_YUY2:
       case GST_VIDEO_FORMAT_UYVY:
       case GST_VIDEO_FORMAT_YVYU:
+#ifdef USE_OMX_TARGET_STARFIVE
+      case GST_VIDEO_FORMAT_Y42B:
+#endif
         dst_width[0] = GST_VIDEO_INFO_WIDTH (vinfo) * 2;
         break;
       case GST_VIDEO_FORMAT_GRAY8:
@@ -609,6 +612,9 @@ gst_omx_video_dec_fill_buffer (GstOMXVid
         dst_height[2] = GST_VIDEO_INFO_FIELD_HEIGHT (vinfo) / 2;
         break;
       case GST_VIDEO_FORMAT_NV12:
+#ifdef USE_OMX_TARGET_STARFIVE
+      case GST_VIDEO_FORMAT_NV21:
+#endif
         dst_width[0] = GST_VIDEO_INFO_WIDTH (vinfo);
         src_stride[1] = nstride;
         src_size[1] = src_stride[1] * nslice / 2;
@@ -638,6 +644,18 @@ gst_omx_video_dec_fill_buffer (GstOMXVid
         src_size[1] = src_stride[1] * nslice;
         dst_height[1] = GST_VIDEO_INFO_FIELD_HEIGHT (vinfo);
         break;
+#ifdef USE_OMX_TARGET_STARFIVE
+      case GST_VIDEO_FORMAT_Y444:
+        dst_width[0] = GST_VIDEO_INFO_WIDTH (vinfo);
+        dst_width[1] = GST_VIDEO_INFO_WIDTH (vinfo);
+        dst_width[2] = GST_VIDEO_INFO_WIDTH (vinfo);
+        src_size[1] = src_size[0];
+        src_size[2] = src_size[0];
+        src_stride[1] = nstride;
+        dst_height[1] = dst_height[0];
+        dst_height[2] = dst_height[0];
+        break;
+#endif
       default:
         g_assert_not_reached ();
         break;
